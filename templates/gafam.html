{% extends "base.html" %}

{% block head_extra %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
<header class="page-header">
    <h1>{{ titre }}</h1>
    {% if sous_titre %}
    <p class="subtitle">{{ sous_titre }}</p>
    {% endif %}
</header>

<section class="content-section">
    <div class="container">
        <p class="main-text">{{ contenu }}</p>

        <!-- Chiffres clés -->
        <div class="chiffres-grid">
            {% for chiffre in chiffres_cles %}
            <div class="chiffre-card">
                <div class="chiffre-valeur">{{ chiffre.valeur }}</div>
                <div class="chiffre-description">{{ chiffre.description }}</div>
            </div>
            {% endfor %}
        </div>

        <!-- Graphiques -->
        <div class="graphiques-section">
            <h2>Émissions des GAFAM</h2>

            <div class="graphiques-duo">
                <div class="graphique-container-medium">
                    <canvas id="emissionsChart"></canvas>
                </div>
                <div class="graphique-container-medium">
                    <canvas id="croissanceChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Entreprises GAFAM -->
        <div class="entreprises-section">
            <h2>Les engagements des géants du numérique</h2>
            <div class="entreprises-grid">
                {% for entreprise in entreprises %}
                <div class="entreprise-card">
                    <div class="entreprise-header">
                        <div class="entreprise-icone">{{ entreprise.icone }}</div>
                        <h3>{{ entreprise.nom }}</h3>
                    </div>
                    <ul class="entreprise-chiffres">
                        {% for chiffre in entreprise.chiffres %}
                        <li>{{ chiffre }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Explications détaillées -->
        <div class="explications-section">
            <h2>Analyse détaillée</h2>
            <div class="explications-grid">
                {% for explication in explications %}
                <div class="explication-card">
                    <h3>{{ explication.titre }}</h3>
                    <p>{{ explication.texte }}</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Sources -->
        {% if sources %}
        <div class="sources-section">
            <h3>Sources</h3>
            <div class="sources-list">
                {% for source in sources %}
                <span class="source-tag">{{ source }}</span>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
    // Graphique 1 : Émissions des GAFAM
    const emissionsCtx = document.getElementById('emissionsChart').getContext('2d');
    const emissionsChart = new Chart(emissionsCtx, {
        type: 'bar',
        data: {
            labels: ['Google', 'Apple', 'Meta', 'Amazon', 'Microsoft'],
            datasets: [{
                label: 'Augmentation des émissions (%) depuis 2019',
                data: [48, 15, 25, 35, 29],
                backgroundColor: [
                    'rgba(66, 133, 244, 0.8)',
                    'rgba(128, 128, 128, 0.8)',
                    'rgba(24, 119, 242, 0.8)',
                    'rgba(255, 153, 0, 0.8)',
                    'rgba(0, 120, 215, 0.8)'
                ],
                borderColor: [
                    'rgba(66, 133, 244, 1)',
                    'rgba(128, 128, 128, 1)',
                    'rgba(24, 119, 242, 1)',
                    'rgba(255, 153, 0, 1)',
                    'rgba(0, 120, 215, 1)'
                ],
                borderWidth: 2,
                borderRadius: 6
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        font: {
                            size: 12,
                            family: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif"
                        }
                    }
                },
                title: {
                    display: true,
                    text: 'Augmentation des émissions GES',
                    font: {
                        size: 14,
                        weight: 'bold'
                    },
                    padding: 15
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Pourcentage d\'augmentation (%)',
                        font: {
                            size: 11,
                            weight: 'bold'
                        }
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.1)'
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            }
        }
    });

    // Graphique 2 : Croissance du secteur
    const croissanceCtx = document.getElementById('croissanceChart').getContext('2d');
    const croissanceChart = new Chart(croissanceCtx, {
        type: 'line',
        data: {
            labels: ['2014', '2015', '2016', '2017', '2018', '2019', '2020', '2021', '2022', '2023', '2024', '2025*'],
            datasets: [{
                label: 'Part du numérique dans les émissions mondiales',
                data: [2.1, 2.3, 2.6, 2.9, 3.2, 3.5, 4.1, 4.7, 5.4, 6.1, 6.8, 7.5],
                borderColor: 'rgba(231, 76, 60, 1)',
                backgroundColor: 'rgba(231, 76, 60, 0.1)',
                borderWidth: 3,
                tension: 0.4,
                fill: true,
                pointBackgroundColor: 'rgba(231, 76, 60, 1)',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        font: {
                            size: 12,
                            family: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif"
                        }
                    }
                },
                title: {
                    display: true,
                    text: 'Évolution de la part du numérique (2014-2025*)',
                    font: {
                        size: 14,
                        weight: 'bold'
                    },
                    padding: 15
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Pourcentage des émissions mondiales (%)',
                        font: {
                            size: 11,
                            weight: 'bold'
                        }
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.1)'
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            }
        }
    });
</script>
{% endblock %}